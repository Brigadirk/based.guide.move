{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://basedguide.ai/schemas/profile_schema.json",
  "title": "Relocation Tax Profile",
  "description": "Unified schema describing every field produced by the Streamlit questionnaire.",
  "type": "object",
  "required": [
    "personalInformation",
    "education",
    "residencyIntentions",
    "finance",
    "socialSecurityAndPensions",
    "futureFinancialPlans",
    "taxDeductionsAndCredits",
    "additionalInformation"
  ],
  "properties": {
    "personalInformation": {
      "$ref": "#/definitions/personalInformation"
    },
    "education": {
      "$ref": "#/definitions/education"
    },
    "residencyIntentions": {
      "$ref": "#/definitions/residencyIntentions"
    },
    "finance": {
      "$ref": "#/definitions/finance"
    },
    "socialSecurityAndPensions": {
      "$ref": "#/definitions/socialSecurityAndPensions"
    },
    "futureFinancialPlans": {
      "$ref": "#/definitions/futureFinancialPlans"
    },
    "taxDeductionsAndCredits": {
      "$ref": "#/definitions/taxDeductionsAndCredits"
    },
    "additionalInformation": {
      "$ref": "#/definitions/additionalInformation"
    },
    "alternativeInterests": {
      "$ref": "#/definitions/alternativeInterests"
    }
  },
  "definitions": {
    "personalInformation": {
      "type": "object",
      "required": ["dateOfBirth", "currentResidency", "nationalities"],
      "properties": {
        "dateOfBirth": {"type": "string", "format": "date"},
        "nationalities": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["country", "willingToRenounce"],
            "properties": {
              "country": {"type": "string"},
              "willingToRenounce": {"type": "boolean"}
            }
          }
        },
        "maritalStatus": {"type": "string", "enum": ["Single", "Official Partnership", "Married", "Divorced", "Widowed", ""]},
        "currentResidency": {
          "type": "object",
          "required": ["country", "status"],
          "properties": {
            "country": {"type": "string"},
            "status": {"type": "string", "enum": ["Citizen", "Permanent Resident", "Temporary Resident"]},
            "duration": {"type": "number", "minimum": 0}
          }
        },
        "relocationPartner": {"type": "boolean"},
        "relocationPartnerInfo": {
          "type": "object",
          "properties": {
            "relationshipType": {
              "type": "string", 
              "enum": ["Spouse", "Fiancé(e)", "Civil Partner", "Domestic Partner", "Unmarried Partner"],
              "description": "Type of relationship - determines what 'official duration' means"
            },
            "sameSex": {"type": "boolean"},
            "fullRelationshipDuration": {
              "type": "number", 
              "minimum": 0,
              "description": "Total time in romantic relationship"
            },
            "officialRelationshipDuration": {
              "type": "number", 
              "minimum": 0,
              "description": "Duration meaning depends on relationshipType: Spouse=marriage years, Civil/Domestic Partner=registered partnership years, Unmarried Partner=cohabiting years, Fiancé(e)=engagement years"
            },
            "canProveRelationship": {
              "type": "boolean",
              "description": "Whether they can provide documentation to prove the relationship"
            },
            "partnerNationalities": {
              "type": "array", 
              "items": {
                "type": "object", 
                "properties": {
                  "country": {"type": "string"},
                  "willingToRenounce": {"type": "boolean"}
                }
              }
            }
          }
        },
        "numRelocationDependents": {"type": "integer", "minimum": 0},
        "relocationDependents": {"type": "array", "items": {"type": "object"}}
      }
    },

    "education": {
      "type": "object",
      "properties": {
        "isStudent": {"type": "boolean"},
        "currentSchool": {"type": "string"},
        "currentFieldOfStudy": {"type": "string"},
        "previousDegrees": {"type": "array", "items": {"type": "object"}},
        "visaSkills": {"type": "array", "items": {"type": "object"}},
        "interestedInStudying": {"type": "boolean"},
        "schoolInterestDetails": {"type": "string"},
        "militaryService": {
          "type": "object",
          "properties": {
            "hasService": {"type": "boolean"},
            "country": {"type": "string"},
            "branch": {"type": "string"}
          }
        }
      }
    },

    "residencyIntentions": {
      "type": "object",
      "required": ["destinationCountry"],
      "properties": {
        "destinationCountry": {
          "type": "object",
          "required": ["country", "moveType"],
          "properties": {
            "country": {"type": "string"},
            "region": {"type": "string", "description": "Specific region or city within the destination country"},
            "moveType": {"type": "string"},
            "intendedTemporaryDurationOfStay": {"type": "number", "minimum": 1},
            "citizenshipStatus": {"type": "boolean"}
          }
        },
        "residencyPlans": {
          "type": "object",
          "properties": {
            "applyForResidency": {"type": "boolean"},
            "maxMonthsWillingToReside": {"type": "number", "minimum": 0},
            "wantMinimumOnly": {"type": "boolean", "description": "Whether user prefers to know minimum requirements rather than set specific preference"},
            "openToVisiting": {"type": "boolean"},
            "exploratoryVisits": {
              "type": "object",
              "description": "Information about planned exploratory visits",
              "properties": {
                "details": {
                  "type": "string",
                  "maxLength": 280,
                  "description": "User's description of their exploratory visit plans, including timing, purpose, and duration"
                }
              }
            }
          }
        },
        "citizenshipPlans": {
          "type": "object",
          "properties": {
            "interestedInCitizenship": {"type": "boolean"},
            "familyTies": {"type": "object"},
            "investment": {"type": "object"},
            "donation": {"type": "object"}
          }
        },
        "languageSkills": {
          "type": "object",
          "properties": {
            "currentProficiency": {"type": "object"},
            "interestedInLearning": {"type": "boolean"},
            "learningCommitment": {"type": "object"}
          }
        },
        "motivationAndCompliance": {
          "type": "object",
          "properties": {
            "motivations": {"type": "array", "items": {"type": "string"}},
            "complianceCommitment": {"type": "object"}
          }
        },
        "familyVisaPlanning": {
          "type": "object",
          "properties": {
            "applicationTimeline": {
              "type": "string",
              "enum": ["together", "sequential", "flexible"]
            },
            "relocationPriority": {
              "type": "string", 
              "enum": ["moveTogetherEssential", "primaryFirstAcceptable", "flexibleTiming"]
            },
            "concerns": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["documentPreparation", "applicationCosts", "processingTiming", "childSchooling", "spouseWork"]
              }
            },
            "specialCircumstances": {"type": "string"}
          }
        },
        "alternativeInterests": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["culturalIntegration", "healthcareSystem", "educationSystem", "employmentMarket", "housingMarket", "socialServices", "legalRequirements", "costOfLiving"]
          }
        },
        "specificQuestions": {"type": "string"},
        "informationDepth": {
          "type": "string",
          "enum": ["overview", "practical", "detailed"]
        },
        "moveMotivation": {
          "type": "string",
          "description": "User's motivation for moving to the destination country"
        },
        "taxCompliantEverywhere": {
          "type": "boolean",
          "description": "Whether user has been fully tax compliant in all jurisdictions"
        },
        "taxComplianceExplanation": {
          "type": "string",
          "description": "Explanation of tax compliance situation if not fully compliant"
        },
        "centerOfLife": {
          "type": "object",
          "properties": {
            "maintainsSignificantTies": {"type": "boolean"},
            "tiesDescription": {"type": "string"}
          }
        },
        "languageProficiency": {
          "type": "object",
          "description": "Comprehensive language proficiency data for individual, partner, and dependents",
          "properties": {
            "individual": {
              "type": "object",
              "description": "Individual's proficiency levels for destination country languages",
              "additionalProperties": {"type": "number", "minimum": 0, "maximum": 7}
            },
            "partner": {
              "type": "object", 
              "description": "Partner's proficiency levels for destination country languages",
              "additionalProperties": {"type": "number", "minimum": 0, "maximum": 7}
            },
            "dependents": {
              "type": "array",
              "description": "Dependents' proficiency levels for destination country languages",
              "items": {
                "type": "object",
                "additionalProperties": {"type": "number", "minimum": 0, "maximum": 7}
              }
            },
            "willing_to_learn": {
              "type": "array",
              "description": "Languages the individual is willing to learn",
              "items": {"type": "string"}
            },
            "can_teach": {
              "type": "object",
              "description": "Individual's teaching capabilities for destination country languages",
              "additionalProperties": {"type": "string", "enum": ["No/not interested", "Informally", "Formally with credentials"]}
            },
            "individual_credentials": {
              "type": "object",
              "description": "Whether individual has formal credentials for destination country languages",
              "additionalProperties": {"type": "boolean"}
            },
            "partner_credentials": {
              "type": "object", 
              "description": "Whether partner has formal credentials for destination country languages",
              "additionalProperties": {"type": "boolean"}
            },
            "partner_willing_to_learn": {
              "type": "array",
              "description": "Languages the partner is willing to learn",
              "items": {"type": "string"}
            },
            "partner_can_teach": {
              "type": "object",
              "description": "Partner's teaching capabilities for destination country languages", 
              "additionalProperties": {"type": "string", "enum": ["No/not interested", "Informally", "Formally with credentials"]}
            },
            "other_languages": {
              "type": "object",
              "description": "Additional languages beyond destination country languages",
              "additionalProperties": {
                "oneOf": [
                  {"type": "string"},
                  {
                    "type": "object",
                    "properties": {
                      "proficiency": {"type": "number", "minimum": 1, "maximum": 7},
                      "canTeach": {"type": "string", "enum": ["No/not interested", "Informally", "Formally with credentials"]},
                      "hasCredentials": {"type": "boolean"}
                    },
                    "required": ["proficiency", "canTeach", "hasCredentials"]
                  }
                ]
              }
            }
          }
        }
      }
    },

    "finance": {
      "type": "object",
      "properties": {
        "skipDetails": {"type": "boolean"},
        "incomeSituation": {"type": "string"},
        "totalWealth": {
          "type": "object",
          "properties": {
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"},
            "total": {"type": "number", "minimum": 0},
            "primaryResidence": {"type": "number", "minimum": 0}
          }
        },
        "incomeSources": {"type": "array", "items": {"type": "object"}},
        "expectedEmployment": {"type": "array", "items": {"type": "object"}},
        "liabilities": {"type": "array", "items": {"type": "object"}},
        "capitalGains": {"type": "array", "items": {"type": "object"}},
        "assets": {"type": "array", "items": {"type": "object"}}
      }
    },

    "socialSecurityAndPensions": {
      "type": "object",
      "properties": {
        "currentCountryContributions": {
          "type": "object",
          "properties": {
            "isContributing": {"type": "boolean"},
            "country": {"type": "string"},
            "yearsOfContribution": {"type": "number", "minimum": 0}
          }
        },
        "futurePensionContributions": {
          "type": "object",
          "properties": {
            "isPlanning": {"type": "boolean"},
            "details": {"type": "array", "items": {"type": "object"}}
          }
        },
        "existingPlans": {
          "type": "object",
          "properties": {
            "hasPlans": {"type": "boolean"},
            "details": {"type": "array", "items": {"type": "object"}}
          }
        }
      }
    },
    "futureFinancialPlans": {
      "type": "object",
      "properties": {
        "plannedInvestments": {"type": "array", "items": {"type": "object"}},
        "plannedPropertyTransactions": {"type": "array", "items": {"type": "object"}},
        "plannedRetirementContributions": {"type": "array", "items": {"type": "object"}},
        "plannedBusinessChanges": {"type": "array", "items": {"type": "object"}}
      }
    },
    "taxDeductionsAndCredits": {
      "type": "object",
      "properties": {
        "potentialDeductions": {"type": "array", "items": {"type": "object"}}
      }
    },
    "additionalInformation": {
      "type": "object",
      "properties": {
        "generalNotes": {"type": "string"},
        "specialSections": {"type": "array", "items": {"type": "string"}}
      }
    },

    "alternativeInterests": {
      "type": "object",
      "properties": {
        "purpose": {"type": "string"},
        "completedViaSummary": {"type": "boolean"}
      }
    }
  }
} 